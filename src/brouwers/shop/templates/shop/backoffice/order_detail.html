{% extends "base.html" %}
{% load i18n shop %}

{% block title %}
{% blocktrans with ref=order.reference %}Shop backoffice | Order {{ ref }}{% endblocktrans %}
{% endblock %}

{% block body-class %}shop-backoffice{% endblock body-class %}


{% block eye-catcher %}
    <header class="container-fluid eye-catcher">
        <div class="container">
            <h1>
                {{ order.reference }} <small>&mdash; {{ order.get_full_name }}</small>
                <i class="pull-right fa fa-shopping-bag fa-2x"></i>
            </h1>
            <a href="{% url 'shop:order-list' %}" class="backlink backlink--light">
                <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                {% trans "back to overview" %}
            </a>

            <p>{% blocktrans trimmed %}
                All the details of the shop order.
            {% endblocktrans %}</p>
        </div>
    </header>
{% endblock %}

{% block content %}
<article class="order-detail">

    <section class="order-detail__status">
        <h2>{% trans "Status" %}</h2>

        <p>{{ order.get_status_display }}</p>

        <h3>
            {% trans "Payment" %}
            {% with status=order.payment.status %}
                <span class="pull-right label {% if status == 'completed' %}label-success{% elif status == 'cancelled' %}label-danger{% else %}label-default{% endif %}">
                    {{ order.payment.get_status_display }}
                </span>
            {% endwith %}
        </h3>
        <p>{% blocktrans with method=order.payment.payment_method.name trimmed %}
            Payment using: {{ method }}
        {% endblocktrans %}</p>
        <p>{% blocktrans with total=order.payment.format_amount trimmed %}
            Total price: {{ total }}
        {% endblocktrans %}</p>
    </section>

    <section class="order-detail__products">
        <h2>
            {% trans "Products" %}
            <span class="badge">{{ num_products }}</span>
        </h2>

        <ul class="product-list">

            <li class="product-list__product product-list__product--headings">
                <span aria-hidden="true">&nbsp;</span>
                <span class="product-list__product-link">{% trans "Product" %}</span>
                <span class="product-list__product-model">{% trans "Model" %}</span>
                <span class="product-list__product-amount">{% trans "Amount" %}</span>
            </li>

            {% for cart_product in order.cart.products.all %}
                {% with product=cart_product.product name=cart_product.product.name %}
                <li class="product-list__product">
                    <img
                        src="{{ cart_product.product.get_image_url }}"
                        class="img-responsive"
                        alt="{% blocktrans %}Product image for '{{ name }}' {% endblocktrans %}"
                    >
                    <a
                        href="{% url 'admin:shop_product_change' product.pk %}"
                        class="product-list__product-link"
                    >{{ name }}</a>
                    <span class="product-list__product-model">
                        {{ product.model_name|default:_('-') }}
                    </span>
                    <span class="product-list__product-amount">{{ cart_product.amount }}</span>
                </li>
                {% endwith %}
            {% endfor %}
        </ul>

    </section>

    <div class="order-detail__customer">

        <section class="order-detail__address order-detail__address--delivery">
            <h2>{% trans "Delivery address" %}</h2>

            {% include "shop/includes/address.html" with address=order.delivery_address %}
        </section>

        <section class="order-detail__address order-detail__address--invoice">
            <h2>{% trans "Invoice address" %}</h2>

            {% if not order.invoice_address %}
                <p>{% trans "Same as delivery address." %}</p>
            {% else %}
                {% include "shop/includes/address.html" with address=order.invoice_address %}
            {% endif %}
        </section>

        <aside class="order-detail__meta">
            <h2>{% trans "Details" %}</h2>
            <p>
                Customer name: <strong>{{ order.get_full_name }}</strong>
            </p>
            <p>
                Contact details:
                <ul>
                    <li><a href="mailto:{{ order.email }}">{{ order.email }}</a></li>
                    {% if order.phone %}
                        <li><a href="tel:{{ order.phone }}">{{ order.phone }}</a></li>
                    {% endif %}
                </ul>
            </p>
            <p>
                Created:
                <time
                    datetime="{{ order.created.isoformat }}"
                    title="{{ order.created }}"
                > {{ order.created|timesince }} ago </time>
            </p>
            <p>
                Last modified:
                <time
                    datetime="{{ order.modified.isoformat }}"
                    title="{{ order.modified }}"
                > {{ order.modified|timesince }} ago </time>
            </p>
            <p>
                Language: {{ order.get_language_display }}
            </p>

        </aside>
    </div>

</article>
{% endblock %}

